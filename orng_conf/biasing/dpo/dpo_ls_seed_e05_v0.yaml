train_data:
  dataset_name: jsonl
  # nug_egs: 5000
  # tsv_paths: az://orngwus2cresco/data/boren/data/LibriSpeech/debug.tsv
  # jsonl_paths: /home/boren/data/ckp/hf_models/Phi-4-multimodal-instruct/metric_vllm_ls_train_debug_biasing_smp2__results.jsonl
  jsonl_paths: az://${DATA_STORAGE}/data/boren/data/ckp/hf_models/phi-libri_ft_m1000_p8_new-QpHq/5000_hf/metric_vllm_ls_train_960hr_biasing_smp_v2_sc3k__results.jsonl
  wer_filter:
    wer_range: [1, 100]
    bwer_range: [1, 100]
  format_preference:
    chosen_key: ref
    rejected_key: hyp

# model_name_or_path: /root/data/ckp/hf_models/phi4_mm_bias
# model_name_or_path: /root/data/ckp/hf_models/Phi-4-multimodal-instruct
model_name_or_path: /root/data/ckp/hf_models/phi-libri_ft_m1000_p8_new-QpHq/5000_hf
# model_name_or_path: /datablob1/users/boren/data/hf_models/phi-libri_ft_m1000_p8_new-QpHq_v1
loss_type: ["sigmoid", "bco_pair", "sft"]
loss_weights: [0.8, 0.2, 1.0]
report_to: [wandb]
num_train_epochs: 1
learning_rate: 1e-5
# new_lora: True
lr_scheduler_type: cosine #cosine
output_dir: ./output
per_device_train_batch_samples: 20
per_device_eval_batch_size: 20
gradient_accumulation_steps: 1
logging_steps: 10
bf16: True
gradient_checkpointing: True
max_prompt_length: 6000
max_completion_length: 1024
epsilon_high: 0.28
save_only_model: True
save_total_limit: 5
save_on_each_node: True
save_steps: 100

eval_strategy: steps
eval_on_start: False
eval_steps: 200
eval_data:
  - nickname: clean_no
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-clean.biasing_100.jsonl
    data_dir: az://${DATA_STORAGE}/data/boren/data
  - nickname: other_no
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-other.biasing_100.jsonl
    data_dir: az://${DATA_STORAGE}/data/boren/data
  - nickname: clean_100
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-clean.biasing_100.jsonl
    data_dir: az://${DATA_STORAGE}/data/boren/data
    bias_key: distractors # distractors
  - nickname: other_100
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-other.biasing_100.jsonl
    bias_key: distractors # distractors
    data_dir: az://${DATA_STORAGE}/data/boren/data
  - nickname: clean_500
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-clean.biasing_500.jsonl
    bias_key: distractors # distractors
    data_dir: az://${DATA_STORAGE}/data/boren/data
  - nickname: other_500
    dataset_name: ls_bias
    jsonl_path: /root/data/librispeech_biasing/ref/test-other.biasing_500.jsonl
    bias_key: distractors # distractors
    data_dir: az://${DATA_STORAGE}/data/boren/data
  # - nickname: clean_1000
  #   dataset_name: ls_bias
  #   jsonl_path: /root/data/librispeech_biasing/ref/test-clean.biasing_1000.jsonl
  #   bias_key: distractors # distractors
  #   data_dir: az://${DATA_STORAGE}/data/boren/data
  # - nickname: other_1000
  #   dataset_name: ls_bias
  #   jsonl_path: /root/data/librispeech_biasing/ref/test-other.biasing_1000.jsonl
  #   bias_key: distractors # distractors
  #   data_dir: az://${DATA_STORAGE}/data/boren/data
